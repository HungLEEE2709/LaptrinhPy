{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>ğŸ¦ Flappy Bird</h1>
    
    <div class="user-info">
        ChÃ o má»«ng, <strong>{{ username }}</strong>!
    </div>
    
    <div id="gameAlert"></div>
    
    <div class="game-controls">
        <button class="btn game-btn" onclick="startGame()">ğŸ® Báº¯t Ä‘áº§u game</button>
        <button class="btn game-btn" onclick="window.location.href='/scores'">ğŸ† Xem Ä‘iá»ƒm sá»‘</button>
        <button class="btn btn-secondary" onclick="logout()">ğŸšª ÄÄƒng xuáº¥t</button>
    </div>
    
    <div style="text-align: center; margin-top: 2rem; color: #666;">
        <p><strong>CÃ¡ch chÆ¡i:</strong></p>
        <p>â€¢ Nháº¥n "Báº¯t Ä‘áº§u game" Ä‘á»ƒ khá»Ÿi Ä‘á»™ng Flappy Bird</p>
        <p>â€¢ DÃ¹ng SPACE hoáº·c click Ä‘á»ƒ cho chim nháº£y</p>
        <p>â€¢ TrÃ¡nh cÃ¡c á»‘ng vÃ  Ä‘áº¡t Ä‘iá»ƒm cao nháº¥t!</p>
        <p>â€¢ Äiá»ƒm sá»‘ cá»§a báº¡n sáº½ Ä‘Æ°á»£c tá»± Ä‘á»™ng lÆ°u</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function startGame() {
    try {
        showAlert('Äang khá»Ÿi Ä‘á»™ng game...', 'success');
        
        const response = await fetch('/start_game', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        const result = await response.json();
        
        if (result.success) {
            showAlert('Game Ä‘Ã£ báº¯t Ä‘áº§u! Kiá»ƒm tra thanh tÃ¡c vá»¥ Ä‘á»ƒ tháº¥y cá»­a sá»• game.', 'success');
        } else {
            showAlert('KhÃ´ng thá»ƒ khá»Ÿi Ä‘á»™ng game: ' + (result.error || 'Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh'), 'danger');
        }
    } catch (error) {
        showAlert('Lá»—i máº¡ng. Vui lÃ²ng thá»­ láº¡i.', 'danger');
    }
}

function logout() {
    window.location.href = '/logout';
}

function showAlert(message, type) {
    const alertDiv = document.getElementById('gameAlert');
    alertDiv.className = `alert alert-${type}`;
    alertDiv.textContent = message;
    alertDiv.style.display = 'block';
    
    setTimeout(() => {
        alertDiv.style.display = 'none';
    }, 3000);
}

// Check for game completion periodically
setInterval(async function() {
    try {
        const response = await fetch('/api/scores');
        const scores = await response.json();
        
        const userScore = scores.find(score => score.username === '{{ username }}');
        if (userScore) {
            // You could display the user's latest score here if needed
            console.log('Latest score for {{ username }}:', userScore.score);
        }
    } catch (error) {
        // Silently ignore errors for this periodic check
    }
}, 5000);
</script>
{% endblock %}
